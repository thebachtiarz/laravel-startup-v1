const sleep = ms => new Promise(resolve => setTimeout(resolve, ms));
const redirectTo = async (url) => {
    await sleep(3000);
    $(location).attr('href', url);
}

var Auth, userData;
const authChecker = async () => {
    let _token = localStorage.getItem('_jwtApiToken');
    if (_token) {
        let _credToken = await axios.get(`/api/user-credentials`, { headers: { 'Accept': 'application/json', 'Authorization': `Bearer ${localStorage.getItem('_jwtApiToken')}` } });
        Auth = (_credToken.data.status == 'success') ? _credToken.data.status : 'error';
        userData = (_credToken.data.status == 'success') ? (_credToken, localStorage.setItem('_credentials', JSON.stringify({ 'name': _credToken.data.response_data[0][0].name, 'email': _credToken.data.response_data[0][0].email }))) : 'error';
    }
}
$(async () => { await authChecker() });
$(async () => { await sleep(1000), (Auth == 'success') ? '' : ((Request(1) != 'signin') ? (toastWarning('Unauthorize'), redirectTo('/signin')) : '') });
const storeUserCredentials = async () => {
    return (userData) ? (userData.data.response_data[0][0]) : await authChecker();
}

const checkCredentials = () => {
    let user = getUserCredentials();
    let findToken = localStorage.getItem('_jwtApiToken');
    findToken ? (user ? '' : redirectTo('/signin')) : redirectTo('/signin');
}

const getUserCredentials = () => {
    let user = localStorage.getItem('_credentials');
    return user ? JSON.parse(user) : storeUserCredentials();
}

// eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJhdWQiOiIxIiwianRpIjoiZGFkZjljMzUxZjY0MzdmNGZiY2VjNjYzM2NjYjA4NGFjNTAwMzMzZDYzMzlhM2FmYjE0MzgzYTE4Y2Y3YmM0NjlmNjMwOTVkODBiN2UzYzQiLCJpYXQiOjE1NzQ5NjMwMzgsIm5iZiI6MTU3NDk2MzAzOCwiZXhwIjoxNTc1NTY3ODM4LCJzdWIiOiIxIiwic2NvcGVzIjpbXX0.KAUjqIb0QAEnvVlhDd4rp52EBds9yaHH8sec5KsijAEtmJgSUHvJzBOB3j2wT9y0AQHrfhzjL4JeUIj0EuMIxa-aQMlGUspzVatrlwaBDFfzpXJoWeukL-pBpRya-j7d-UqsIPphwKMVta7xfj-uY0OOaV5ne_rphU5FAhTL0IsK1hPO-3o4flz9zjaneCCD6Ti3-_bAL2BmzNT4zStPI0ppkMuHByr5iLsyDigOMcVnKcPgBC-KzZryD0kMRuC8r9iwn8HKJEovruQ6dcwa0ZetvRVUPKOc2q-v16FNS6WX01m_uFcsRt-a26sm7A3yxPYRGwp750f3_UtSw3zEDmyB6doxkpM786WP1BZm896Oiu5TVLgnYp5z2BnwkCwb4mvB_-jY9nRJvyEJUPS_DlrRyaWM9KTfJutVq3ckkS4Y_DkjPNTJwTdh_ebAer9mbD-sTEpB1rJSLwO-WsZZCOSfuRm9S5_9tcihlDr07PdUEszRRR6gAb6KJF-AoANLHCJJDq9O7-qnMcseEBKLaxxYrxgAf3dugioAMJ6M51QhcJ829B9kY9brxCkfr3OSkSOadW0_esoCgIlZA9V4j6GKaMGe09ayPOnyxRbxN6M-AgJpAQ1lKxBw34p0-NlIeuD7IeErT7-lgpFarywAUv-oB1LaOrvAEbyiK5eK-1A
// eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJhdWQiOiIxIiwianRpIjoiNTU3NmM2MzlmZThiMTkxYTQ4ZWUzYzE0YWFkNWVhMGYwN2I0MzE1NDNmNjIyOGFjOTJiODU4MTM2MTk3Nzk1NTE1YTYzYzJiMGZjY2ViOTQiLCJpYXQiOjE1NzQ5NjQxNjIsIm5iZiI6MTU3NDk2NDE2MiwiZXhwIjoxNTc1NTY4OTYyLCJzdWIiOiIyIiwic2NvcGVzIjpbXX0.OotQBZyq-NyaTjh9GVAK_VLJNKTkWYjTs_1iWJQMAJliuH1LuWHyJY1lcEM7sEYg_Q1tx8a9cPh75_VMa7S52aLB8BAvNEzfHzQ2HLSS78q5xC_QyVmh8demwfEGevmLYaPvB1KWpOCq4fSkLcPepkio6ZmLJH4k7NoPHOEGH1l0P_9k7QQE6mEeUsv4CHiBtdOlEGcABByZXUkGxXGrJaEP7FP_ewCGzexx90NKyAfQ3N3GVa4cHpZE2bNqTX4XTB2fpyQ3ydCZRNDgEM6Iltc_MzOktIqahfKBFbhR6aykJRUo8KwI5YDg5x8jyD9Q9cY90PmjxN6fKKGrNZqZV_-aH-7VeD9AKnCMI35UlrmgUbVMRXKSBDuHG6EF80NiC5nfj17SQEN2t6qHj6x_3F0Wu_vOKXiiEGEgsGGpNiT4Vguj_084V7wQnRLgipVZ0OlpfOj6CqYQtnhnY9Vk3O1bhpL0eQXSDvkxSenFxPW2HrgLtJvmrhqJK4oB9xIV2f3v3c2f8nlVmawfwV0jTvx_dKlA441kV02cWvBwy-4g_ZnJh4AEhVQXvrMRFkCJDxBnVNgSLsz6PVRLPiKlEc4lE4ANgFdOr_XadQuGtrfzZBrGEXm39LsSbbu2ww07D6c6w5Y5OzeGmaeVgBNJFLfTOU4zOZpfRyJgn7adoNc

/**
 * logout
 */
const userSignout = () => {
    localStorage.clear();
    toastSuccess('Logout Successfully');
    redirectTo('/signin');
}
