const sleep = ms => new Promise(resolve => setTimeout(resolve, ms));

var userData;
const getDataUser = async () => {
    let findToken = localStorage.getItem('_jwtApiToken');
    if (findToken) {
        userData = await axios.get(`/api/user-credentials`, {
            headers: {
                'Accept': 'application/json',
                'Authorization': `Bearer ${localStorage.getItem('_jwtApiToken')}`
            }
        });
    } else {
        if (Request(1) != 'signin') {
            redirectTo('/signin')
        }
    }
}

$(async () => await getDataUser());

const storeUserCredentials = () => {
    return (userData) ? (userData.data.response_data[0][0]) : getUserCredentials();
}

const redirectTo = async (url) => {
    await sleep(3000);
    $(location).attr('href', url);
}

const checkCredentials = () => {
    let user = getUserCredentials();
    let findToken = localStorage.getItem('_jwtApiToken');
    findToken ? (user ? '' : redirectTo('/signin')) : redirectTo('/signin');
}

const getUserCredentials = () => {
    let user = localStorage.getItem('_credentials');
    return user ? JSON.parse(user) : storeUserCredentials();
}


/**
 * logout
 */
const userSignout = () => {
    localStorage.clear();
    toastSuccess('Logout Successfully');
    redirectTo('/signin');
}
