$(document).on('click', '.addProduct', function () {
    openFormAddProduct()
});

$(document).on('click', '.prodEdit', function () {
    let prodID = $(this).data('idprod');
    getDocProducts(prodID);
});

$(document).on('click', '.prodFormClose', function () {
    $('#view-modify-product').hide(1000);
});

$(document).on('click', '.prodSave', function () {
    let name = $('#product-name').val();
    let detail = $('#product-detail').val();
    saveProductModify('', { 'name': name, 'detail': detail });
});

$(document).on('click', '.prodEditSave', function () {
    let prodID = $(this).data('idprod');
    let name = $('#product-name').val();
    let detail = $('#product-detail').val();
    saveProductModify({ 'id': prodID, 'name': name, 'detail': detail });
});

$(document).on('click', '.prodDelete', function () {
    let prodID = $(this).data('idprod');
    deleteProduct(prodID);
});

const getDocProducts = (param = '') => {
    let prm = param ? `/${param}` : '';
    axios.get(`/api/doc-products${prm}`, { headers: { 'Accept': 'application/json', 'Authorization': `Bearer ${localStorage.getItem('_jwtApiToken')}` } }).then(response => { prm ? ((response.data.status == 'success') ? (openFormEditProduct(response.data.response_data[0])) : '') : ((response.data.status == 'success') ? ($('#view-doc-products').html(dataTableDocProducts(response.data.response_data[0])), $("#table-doc-products").DataTable()) : '') }).catch(error => toastWarning(error));
}

const saveProductModify = (editData = '', addData = '') => {
    let _param = editData ? editData : addData;
    editData ? (axios.put(`/api/doc-products/${_param.id}`, { name: _param.name, detail: _param.detail }, { headers: { 'Accept': 'application/json', 'Authorization': `Bearer ${localStorage.getItem('_jwtApiToken')}` } }).then(response => { toastResponse(response.data.status, response.data.message), $('.prodFormClose').click(), getDocProducts(), scrollEasing('#view-doc-products', '120') }).catch(error => toastWarning(error))) : (axios.post(`/api/doc-products`, { name: _param.name, detail: _param.detail }, { headers: { 'Accept': 'application/json', 'Authorization': `Bearer ${localStorage.getItem('_jwtApiToken')}` } }).then(response => { toastResponse(response.data.status, response.data.message), $('.prodFormClose').click(), getDocProducts(), scrollEasing('#view-doc-products', '120') }).catch(error => toastWarning(error)));
}

const deleteProduct = (idprod) => {
    axios.delete(`/api/doc-products/${idprod}`, { headers: { 'Accept': 'application/json', 'Authorization': `Bearer ${localStorage.getItem('_jwtApiToken')}` } }).then(response => { toastResponse(response.data.status, response.data.message), getDocProducts() }).catch(error => toastWarning(error));
}

const openFormAddProduct = () => {
    let form = `<div class="card"><div class="card-header"><h3 class="card-title">Add New Product</h3><div class="card-tools"><button class="btn btn-light prodFormClose"><i class="fas fa-times"></i></button></div></div><div class="card-body"><div class="form-group"><label for="product-name">Product Name</label><input type="text" class="form-control" id="product-name" placeholder="Hand Made Origami"></div><div class="form-group"><label for="product-detail">Product Detail</label><textarea class="form-control" id="product-detail" placeholder="Very Rare Handmade Origami" cols="30" rows="10"></textarea></div><div class="form-group"><button type="submit" class="btn btn-info btn-sm float-right text-bold text-capitalize prodSave"><i class="fas fa-save fa-sm"></i>&ensp;save product</button></div></div></div>`;
    $('#view-modify-product').html(form);
    $('#view-modify-product').show(1000);
    scrollEasing('#view-modify-product', '65');
}

const openFormEditProduct = (data) => {
    let form = `<div class="card"><div class="card-header"><h3 class="card-title">Edit Product</h3><div class="card-tools"><button class="btn btn-light prodFormClose"><i class="fas fa-times"></i></button></div></div><div class="card-body"><div class="form-group"><label for="product-name">Product Name</label><input type="text" class="form-control" id="product-name" placeholder="Hand Made Origami" value="${data.name}"></div><div class="form-group"><label for="product-detail">Product Detail</label><textarea class="form-control" id="product-detail" placeholder="Very Rare Handmade Origami" cols="30" rows="10">${data.detail}</textarea></div><div class="form-group"><button type="submit" class="btn btn-info btn-sm float-right text-bold text-capitalize prodEditSave" data-idprod="${data.id_prod}"><i class="fas fa-save fa-sm"></i>&ensp;save product</button></div></div></div>`;
    $('#view-modify-product').html(form);
    $('#view-modify-product').show(1000);
    scrollEasing('#view-modify-product', '65');
}

// create data table
const viewDataTableOpen = () => {
    return `<div class="card"><div class="card-body"><div class="container-fluid table-responsive"><table id="table-doc-products" class="table table-bordered table-striped">`;
}
// data table header
const viewDataTableHeader = () => {
    let header = viewDataTableOpen() + `<thead><tr><th>#</th><th>Name</th><th>Detail</th><th>Created</th><th>Updated</th><th>Action</th></tr></thead>`;
    return header;
}
// body doc products
const dataTableDocProducts = (data) => {
    let body = viewDataTableHeader() + `<tbody>`;
    data.forEach((prod, idx) => {
        body += `<tr><td class="text-capitalize">${idx + 1}</td><td class="text-capitalize">${prod.name}</td><td>${prod.detail}</td><td>${prod.created}</td><td>${prod.updated}</td><td><button class="btn btn-sm btn-warning text-bold prodEdit" data-idprod="${prod.id_prod}"><i class="fas fa-edit fa-sm"></i>&ensp;Edit</button><button class="btn btn-sm btn-danger text-bold prodDelete mt-2 mt-sm-0 ml-0 ml-sm-2" data-idprod="${prod.id_prod}"><i class="fas fa-trash fa-sm"></i>&ensp;Delete</button></td></tr>`;
    });
    body += `</tbody>` + viewDataTableClose();
    return body;
}
// data table close
const viewDataTableClose = () => {
    return `</table></div></div></div>`;
}
////

$(getDocProducts());
